---
import Layout from '../layouts/mainLayout.svelte';
import Container from '../components/atoms/Container.svelte';
import Services from '../components/molecules/Services.svelte';
import List from '../components/molecules/List.svelte';
import Brands from '../components/molecules/Brands.svelte';
import Quote from '../components/molecules/Quote.svelte';

import fetchData from '../helpers/fetchData';
import siteQuery from '../queries/site';
import homeQuery from '../queries/home';

let title = 'Abell Design';
const siteData = await fetchData(fetch, siteQuery);
const { headers, footers, menu } = siteData;

const header = headers[0];
const footer = footers[0];

const data = (await fetchData(fetch, homeQuery)) || {
    works: [],
    services: [],
    homepage: [{}],
    brands: []
};

if (data && data.works) {
    data.works =
        (data.works &&
            data.works.filter(work => work.showOnHomepage).map((work, index) => {
                work.oddEven = index % 2;
                return work;
            })) ||
        [];
} else {
    data.works = [];
}

if (data && data.services) {
    data.services = data.services.filter(service => service.showOnHomepage).map((service, index) => {
        service.oddEven = index % 2;
        return service;
    });
} else {
    data.services = [];
}

const { works, services, homepage, brands } = data;

---
<Layout
    title={title}
    menu={menu}
    header={header}
    footer={footer}
    isHome={true}
    client:load
    homepage={homepage[0]}
>
    <Container isHome={true}>
        <Services title="Services" data={services} slugPrefix="/work" linkText="More Services" />
        <List title="Work" data={works} slugPrefix="/work" linkText="More Work" />
        <Brands {brands} brandsText={homepage[0].brandsText} />
        <Quote quote={homepage[0].quote} quoter={homepage[0].quoter} />
    </Container>
</Layout>
